hostname R1
!
ipv6 unicast-routing
ipv6 cef
!
interface Loopback0
 no ip address
 ipv6 address 2000:2:100::1/128
 ipv6 enable
 ipv6 rip RIPNG enable
!

interface GigabitEthernet1/0
 no ip address
 ipv6 nd dad attempts 0
 ipv6 address 2000:1:100:1:2::1/80
 ipv6 enable
 
 ipv6 rip RIPNG enable
 
 no shutdown
!

interface GigabitEthernet2/0
 no ip address
 ipv6 nd dad attempts 0
 ipv6 address 2000:1:100:1:4::1/80
 ipv6 enable
 
 ipv6 rip RIPNG enable
 
 no shutdown
!

!
ipv6 router rip RIPNG
 
!
router bgp 100
 bgp router-id 1.1.1.1
 bgp log-neighbor-changes
 no bgp default ipv4-unicast
 !
 
 neighbor 2000:2:100::2 remote-as 100
 neighbor 2000:2:100::2 description to_R2_peer
 
 neighbor 2000:2:100::2 update-source Loopback0
 neighbor 2000:2:100::2 next-hop-self
 
  neighbor 2000:2:100::2 send-community
 
 
 
 neighbor 2000:2:100::3 remote-as 100
 neighbor 2000:2:100::3 description to_R3_peer
 
 neighbor 2000:2:100::3 update-source Loopback0
 neighbor 2000:2:100::3 next-hop-self
 
  neighbor 2000:2:100::3 send-community
 
 
 
 neighbor 2000:2:100::4 remote-as 100
 neighbor 2000:2:100::4 description to_R4_peer
 
 neighbor 2000:2:100::4 update-source Loopback0
 neighbor 2000:2:100::4 next-hop-self
 
  neighbor 2000:2:100::4 send-community
 
 
 
 neighbor 2000:2:100::6 remote-as 100
 neighbor 2000:2:100::6 description to_R6_peer
 
 neighbor 2000:2:100::6 update-source Loopback0
 neighbor 2000:2:100::6 next-hop-self
 
  neighbor 2000:2:100::6 send-community
 
 
 
 neighbor 2000:2:100::5 remote-as 100
 neighbor 2000:2:100::5 description to_R5_peer
 
 neighbor 2000:2:100::5 update-source Loopback0
 neighbor 2000:2:100::5 next-hop-self
 
  neighbor 2000:2:100::5 send-community
 
 
 
 neighbor 2000:2:100::8 remote-as 100
 neighbor 2000:2:100::8 description to_R8_peer
 
 neighbor 2000:2:100::8 update-source Loopback0
 neighbor 2000:2:100::8 next-hop-self
 
  neighbor 2000:2:100::8 send-community
 
 
 
 !
 address-family ipv6 unicast
 
  neighbor 2000:2:100::2 activate
 
  neighbor 2000:2:100::3 activate
 
  neighbor 2000:2:100::4 activate
 
  neighbor 2000:2:100::6 activate
 
  neighbor 2000:2:100::5 activate
 
  neighbor 2000:2:100::8 activate
 
 
  ! Networks to advertise
  
  network 2000:1:100:1:2::/80
  
  network 2000:1:100:1:4::/80
  
 
  network 2000:2:100::1/128
  redistribute connected
  
  redistribute rip RIPNG route-map RIP_TO_BGP
  
 exit-address-family
!

! Route-map for administrative control of RIP redistribution
route-map RIP_TO_BGP permit 10
!


!
! --- GAO-REXFORD POLICIES ---
! Community Definitions
! 100:10 = Routes from CUSTOMER
! 100:20 = Routes from PEER
! 100:30 = Routes from PROVIDER
!
ip bgp-community new-format
!
! community-lists
ip community-list standard FROM_CUSTOMER permit 100:10
ip community-list standard FROM_PEER     permit 100:20
ip community-list standard FROM_PROVIDER permit 100:30
!
! INBOUND POLICIES (Prefer Customer > Peer > Provider)
!
route-map MAP_FROM_CUSTOMER permit 10
 set local-preference 200
 set community 100:10
!
route-map MAP_FROM_PEER permit 10
 set local-preference 100
 set community 100:20
!
route-map MAP_FROM_PROVIDER permit 10
 set local-preference 50
 set community 100:30
!
! OUTBOUND POLICIES (Valley-Free Rule)
!
! To Customer: Advertise EVERYTHING (Customer, Peer, Provider, Self)
route-map MAP_TO_CUSTOMER permit 10
!
! To Peer: Advertise ONLY Customer routes (and Self)
route-map MAP_TO_PEER permit 10
 match community FROM_CUSTOMER
!
! To Provider: Advertise ONLY Customer routes (and Self)
route-map MAP_TO_PROVIDER permit 10
 match community FROM_CUSTOMER
!

end
write memory