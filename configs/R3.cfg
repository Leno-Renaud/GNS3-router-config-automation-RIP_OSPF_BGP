hostname R3
!
ipv6 unicast-routing
ipv6 cef
!
interface Loopback0
 no ip address
 ipv6 address 2000:2:100::3/128
 ipv6 enable
 ipv6 rip RIPNG enable
!

interface GigabitEthernet2/0
 no ip address
 ipv6 nd dad attempts 0
 ipv6 address 2000:1:100:2:3::3/80
 ipv6 enable
 
 ipv6 rip RIPNG enable
 
 no shutdown
!

interface GigabitEthernet1/0
 no ip address
 ipv6 nd dad attempts 0
 ipv6 address 2000:1:100:3:8::3/80
 ipv6 enable
 
 ipv6 rip RIPNG enable
 
 no shutdown
!

interface GigabitEthernet3/0
 no ip address
 ipv6 nd dad attempts 0
 ipv6 address 2000:1:100:3:6::3/80
 ipv6 enable
 
 ipv6 rip RIPNG enable
 
 no shutdown
!

interface FastEthernet0/0
 no ip address
 ipv6 nd dad attempts 0
 ipv6 address 2000:1:100:3:5::3/80
 ipv6 enable
 
 ipv6 rip RIPNG enable
 
 no shutdown
!

!
ipv6 router rip RIPNG
 
!
router bgp 100
 bgp router-id 3.3.3.3
 bgp log-neighbor-changes
 no bgp default ipv4-unicast
 !
 
 neighbor 2000:2:100::1 remote-as 100
 neighbor 2000:2:100::1 description to_R1_peer
 
 neighbor 2000:2:100::1 update-source Loopback0
 
 
 neighbor 2000:2:100::2 remote-as 100
 neighbor 2000:2:100::2 description to_R2_peer
 
 neighbor 2000:2:100::2 update-source Loopback0
 
 
 neighbor 2000:2:100::4 remote-as 100
 neighbor 2000:2:100::4 description to_R4_peer
 
 neighbor 2000:2:100::4 update-source Loopback0
 
 
 neighbor 2000:2:100::6 remote-as 100
 neighbor 2000:2:100::6 description to_R6_peer
 
 neighbor 2000:2:100::6 update-source Loopback0
 
 
 neighbor 2000:2:100::5 remote-as 100
 neighbor 2000:2:100::5 description to_R5_peer
 
 neighbor 2000:2:100::5 update-source Loopback0
 
 
 neighbor 2000:2:100::8 remote-as 100
 neighbor 2000:2:100::8 description to_R8_peer
 
 neighbor 2000:2:100::8 update-source Loopback0
 
 
 !
 address-family ipv6 unicast
 
  neighbor 2000:2:100::1 activate
    
    neighbor 2000:2:100::1 next-hop-self
    
  
   neighbor 2000:2:100::1 send-community
   
  
 
  neighbor 2000:2:100::2 activate
    
    neighbor 2000:2:100::2 next-hop-self
    
  
   neighbor 2000:2:100::2 send-community
   
  
 
  neighbor 2000:2:100::4 activate
    
    neighbor 2000:2:100::4 next-hop-self
    
  
   neighbor 2000:2:100::4 send-community
   
  
 
  neighbor 2000:2:100::6 activate
    
    neighbor 2000:2:100::6 next-hop-self
    
  
   neighbor 2000:2:100::6 send-community
   
  
 
  neighbor 2000:2:100::5 activate
    
    neighbor 2000:2:100::5 next-hop-self
    
  
   neighbor 2000:2:100::5 send-community
   
  
 
  neighbor 2000:2:100::8 activate
    
    neighbor 2000:2:100::8 next-hop-self
    
  
   neighbor 2000:2:100::8 send-community
   
  
 
 
  ! Networks to advertise
  
  network 2000:1:100:2:3::/80
  
  network 2000:1:100:3:5::/80
  
  network 2000:1:100:3:6::/80
  
  network 2000:1:100:3:8::/80
  
 
  network 2000:2:100::3/128
  redistribute connected
  
  redistribute rip RIPNG route-map RIP_TO_BGP
  
 exit-address-family
!

! Route-map for administrative control of RIP redistribution
route-map RIP_TO_BGP permit 10
!


!
! --- GAO-REXFORD POLICIES ---
! Community Definitions
! 100:10 = Routes from CUSTOMER
! 100:20 = Routes from PEER
! 100:30 = Routes from PROVIDER
!
ip bgp-community new-format
!
! community-lists
ip community-list standard FROM_CUSTOMER permit 100:10
ip community-list standard FROM_PEER     permit 100:20
ip community-list standard FROM_PROVIDER permit 100:30

! Prefix-lists (SELF): allow ping without specifying source
! - Loopbacks: 2000:2:<AS>::X/128
! - Intra-AS links: 2000:1:<AS>:.../80
ipv6 prefix-list PL_SELF_AS100 seq 10 permit 2000:2:100::/48 le 128
ipv6 prefix-list PL_SELF_AS100 seq 20 permit 2000:1:100::/48 le 80
!
! INBOUND POLICIES (Prefer Customer > Peer > Provider)
!
route-map MAP_FROM_CUSTOMER permit 10
 set local-preference 200
 set community 100:10
!
route-map MAP_FROM_PEER permit 10
 set local-preference 100
 set community 100:20
!
route-map MAP_FROM_PROVIDER permit 10
 set local-preference 50
 set community 100:30
!
! OUTBOUND POLICIES (Valley-Free Rule)
!
! To Customer: Advertise EVERYTHING (Customer, Peer, Provider, Self)
route-map MAP_TO_CUSTOMER permit 10
!
! To Peer: Advertise ONLY Customer routes (and Self)
route-map MAP_TO_PEER permit 10
 match community FROM_CUSTOMER
route-map MAP_TO_PEER permit 20
 match ipv6 address prefix-list PL_SELF_AS100
!
! To Provider: Advertise ONLY Customer routes (and Self)
route-map MAP_TO_PROVIDER permit 10
 match community FROM_CUSTOMER
route-map MAP_TO_PROVIDER permit 20
 match ipv6 address prefix-list PL_SELF_AS100
!

end
write memory