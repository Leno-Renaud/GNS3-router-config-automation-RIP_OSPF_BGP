hostname R17
!
ipv6 unicast-routing
ipv6 cef
!
interface Loopback0
 no ip address
 ipv6 address 2000:2:500::17/128
 ipv6 enable
 ipv6 rip RIPNG enable
!

interface FastEthernet0/0
 no ip address
 ipv6 nd dad attempts 0
 ipv6 address 2000:1:0:400:500:16:17:11/112
 ipv6 enable
 
 no shutdown
!

interface GigabitEthernet1/0
 no ip address
 ipv6 nd dad attempts 0
 ipv6 address 2000:1:0:200:500:11:17:11/112
 ipv6 enable
 
 no shutdown
!

!
ipv6 router rip RIPNG
 
 ipv6 rip RIPNG default-information originate
 
!
router bgp 500
 bgp router-id 17.17.17.17
 bgp log-neighbor-changes
 no bgp default ipv4-unicast
 !
 
 neighbor 2000:1:0:400:500:16:17:10 remote-as 400
 neighbor 2000:1:0:400:500:16:17:10 description to_R16_provider
 
 
 neighbor 2000:1:0:200:500:11:17:b remote-as 200
 neighbor 2000:1:0:200:500:11:17:b description to_R11_customer
 
 
 !
 address-family ipv6 unicast
 
  neighbor 2000:1:0:400:500:16:17:10 activate
    
  
   neighbor 2000:1:0:400:500:16:17:10 send-community
   
   neighbor 2000:1:0:400:500:16:17:10 route-map MAP_FROM_PROVIDER in
   neighbor 2000:1:0:400:500:16:17:10 route-map MAP_TO_PROVIDER out
   
  
 
  neighbor 2000:1:0:200:500:11:17:b activate
    
  
   neighbor 2000:1:0:200:500:11:17:b send-community
   
   neighbor 2000:1:0:200:500:11:17:b route-map MAP_FROM_CUSTOMER in
   neighbor 2000:1:0:200:500:11:17:b route-map MAP_TO_CUSTOMER out
   
  
 
 
  ! Networks to advertise
  
  network 2000:1:0:200:500:11:17::/112
  
  network 2000:1:0:400:500:16:17::/112
  
 
  network 2000:2:500::17/128
  redistribute connected
  
  redistribute rip RIPNG route-map RIP_TO_BGP
  
 exit-address-family
!

! Route-map for administrative control of RIP redistribution
route-map RIP_TO_BGP permit 10
!


!
! --- GAO-REXFORD POLICIES ---
! Community Definitions
! 100:10 = Routes from CUSTOMER
! 100:20 = Routes from PEER
! 100:30 = Routes from PROVIDER
!
ip bgp-community new-format
!
! community-lists
ip community-list standard FROM_CUSTOMER permit 500:10
ip community-list standard FROM_PEER     permit 500:20
ip community-list standard FROM_PROVIDER permit 500:30

! Prefix-lists (SELF): allow ping without specifying source
! - Loopbacks: 2000:2:<AS>::X/128
! - Intra-AS links: 2000:1:<AS>:.../80
ipv6 prefix-list PL_SELF_AS500 seq 10 permit 2000:2:500::/48 le 128
ipv6 prefix-list PL_SELF_AS500 seq 20 permit 2000:1:500::/48 le 80
!
! INBOUND POLICIES (Prefer Customer > Peer > Provider)
!
route-map MAP_FROM_CUSTOMER permit 10
 set local-preference 200
 set community 500:10
!
route-map MAP_FROM_PEER permit 10
 set local-preference 100
 set community 500:20
!
route-map MAP_FROM_PROVIDER permit 10
 set local-preference 50
 set community 500:30
!
! OUTBOUND POLICIES (Valley-Free Rule)
!
! To Customer: Advertise EVERYTHING (Customer, Peer, Provider, Self)
route-map MAP_TO_CUSTOMER permit 10
!
! To Peer: Advertise ONLY Customer routes (and Self)
route-map MAP_TO_PEER permit 10
 match community FROM_CUSTOMER
route-map MAP_TO_PEER permit 20
 match ipv6 address prefix-list PL_SELF_AS500
!
! To Provider: Advertise ONLY Customer routes (and Self)
route-map MAP_TO_PROVIDER permit 10
 match community FROM_CUSTOMER
route-map MAP_TO_PROVIDER permit 20
 match ipv6 address prefix-list PL_SELF_AS500
!

end
write memory