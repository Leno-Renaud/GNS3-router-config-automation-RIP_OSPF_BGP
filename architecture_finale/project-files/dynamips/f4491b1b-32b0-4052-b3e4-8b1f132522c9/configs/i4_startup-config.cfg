!
hostname R7
!
ipv6 unicast-routing
ipv6 cef
!
interface Loopback0
 no ip address
 ipv6 address 2000:2:200::7/128
 ipv6 enable
 ipv6 ospf 1 area 0
!

interface FastEthernet0/0
 no ip address
 ipv6 nd dad attempts 0
 ipv6 address 2000:1:0:100:200:7:8::7/112
 ipv6 enable
 
 no shutdown
!

interface GigabitEthernet1/0
 no ip address
 ipv6 nd dad attempts 0
 ipv6 address 2000:1:200:7:10::7/80
 ipv6 enable
 
 ipv6 ospf 1 area 0
 
 ipv6 ospf cost 10
 
 
 no shutdown
!

interface GigabitEthernet3/0
 no ip address
 ipv6 nd dad attempts 0
 ipv6 address 2000:1:200:7:14::7/80
 ipv6 enable
 
 ipv6 ospf 1 area 0
 
 ipv6 ospf cost 10
 
 
 no shutdown
!

!
ipv6 router ospf 1
 router-id 7.7.7.7
 passive-interface Loopback0
 
 redistribute bgp 200 route-map BGP_TO_OSPF
 
!
router bgp 200
 bgp router-id 7.7.7.7
 bgp log-neighbor-changes
 no bgp default ipv4-unicast
 !
 
 neighbor 2000:1:0:100:200:7:8::8 remote-as 100
 neighbor 2000:1:0:100:200:7:8::8 description to_R8_provider
 
 
 
  neighbor 2000:1:0:100:200:7:8::8 send-community
  neighbor 2000:1:0:100:200:7:8::8 route-map MAP_FROM_PROVIDER in
  neighbor 2000:1:0:100:200:7:8::8 route-map MAP_TO_PROVIDER out
 
 
 
 neighbor 2000:2:200::9 remote-as 200
 neighbor 2000:2:200::9 description to_R9_peer
 
 neighbor 2000:2:200::9 update-source Loopback0
 neighbor 2000:2:200::9 next-hop-self
 
  neighbor 2000:2:200::9 send-community
 
 
 
 neighbor 2000:2:200::10 remote-as 200
 neighbor 2000:2:200::10 description to_R10_peer
 
 neighbor 2000:2:200::10 update-source Loopback0
 neighbor 2000:2:200::10 next-hop-self
 
  neighbor 2000:2:200::10 send-community
 
 
 
 neighbor 2000:2:200::11 remote-as 200
 neighbor 2000:2:200::11 description to_R11_peer
 
 neighbor 2000:2:200::11 update-source Loopback0
 neighbor 2000:2:200::11 next-hop-self
 
  neighbor 2000:2:200::11 send-community
 
 
 
 neighbor 2000:2:200::12 remote-as 200
 neighbor 2000:2:200::12 description to_R12_peer
 
 neighbor 2000:2:200::12 update-source Loopback0
 neighbor 2000:2:200::12 next-hop-self
 
  neighbor 2000:2:200::12 send-community
 
 
 
 neighbor 2000:2:200::13 remote-as 200
 neighbor 2000:2:200::13 description to_R13_peer
 
 neighbor 2000:2:200::13 update-source Loopback0
 neighbor 2000:2:200::13 next-hop-self
 
  neighbor 2000:2:200::13 send-community
 
 
 
 neighbor 2000:2:200::14 remote-as 200
 neighbor 2000:2:200::14 description to_R14_peer
 
 neighbor 2000:2:200::14 update-source Loopback0
 neighbor 2000:2:200::14 next-hop-self
 
  neighbor 2000:2:200::14 send-community
 
 
 
 !
 address-family ipv6 unicast
 
  neighbor 2000:1:0:100:200:7:8::8 activate
 
  neighbor 2000:2:200::9 activate
 
  neighbor 2000:2:200::10 activate
 
  neighbor 2000:2:200::11 activate
 
  neighbor 2000:2:200::12 activate
 
  neighbor 2000:2:200::13 activate
 
  neighbor 2000:2:200::14 activate
 
 
  ! Networks to advertise
  
  network 2000:1:0:100:200:7:8::/112
  
  network 2000:1:200:7:10::/80
  
  network 2000:1:200:7:14::/80
  
 
  network 2000:2:200::7/128
  redistribute connected
  
  redistribute ospf 1 include-connected route-map OSPF_TO_BGP
  
 exit-address-family
!

! Route-map to tag BGP routes redist into OSPF
route-map BGP_TO_OSPF permit 10
 set tag 200
!
! Route-map to filter OSPF routes (deny tagged routes)
route-map OSPF_TO_BGP deny 10
 match tag 200
!
route-map OSPF_TO_BGP permit 20
!


!
! --- GAO-REXFORD POLICIES ---
! Community Definitions
! 100:10 = Routes from CUSTOMER
! 100:20 = Routes from PEER
! 100:30 = Routes from PROVIDER
!
ip bgp-community new-format
!
! community-lists
ip community-list standard FROM_CUSTOMER permit 200:10
ip community-list standard FROM_PEER     permit 200:20
ip community-list standard FROM_PROVIDER permit 200:30
!
! INBOUND POLICIES (Prefer Customer > Peer > Provider)
!
route-map MAP_FROM_CUSTOMER permit 10
 set local-preference 200
 set community 200:10
!
route-map MAP_FROM_PEER permit 10
 set local-preference 100
 set community 200:20
!
route-map MAP_FROM_PROVIDER permit 10
 set local-preference 50
 set community 200:30
!
! OUTBOUND POLICIES (Valley-Free Rule)
!
! To Customer: Advertise EVERYTHING (Customer, Peer, Provider, Self)
route-map MAP_TO_CUSTOMER permit 10
!
! To Peer: Advertise ONLY Customer routes (and Self)
route-map MAP_TO_PEER permit 10
 match community FROM_CUSTOMER
!
! To Provider: Advertise ONLY Customer routes (and Self)
route-map MAP_TO_PROVIDER permit 10
 match community FROM_CUSTOMER
!

end
write memory